<mujoco model="Gripper-with-LEGO-tray">
  <!-- 如需地面/相机，可保留你的 scene.xml -->
  <include file="scene.xml"/>

  <!-- SDF 求解参数，可按需要调大或调小 -->
  <option cone="elliptic" impratio="10" integrator="implicitfast"
        sdf_iterations="50" sdf_initpoints="40" ccd_iterations="100"
        timestep="0.001"/>
  <!--  sdflib -->
  <extension>
    <plugin plugin="mujoco.sdf.sdflib">
      <instance name="sdflego">
        <!-- 0: 用网格自动推 aabb；若接触点过多可先把 sdf_initpoints 降低 -->
        <config key="aabb" value="0"/>
      </instance>
    </plugin>
  </extension>

  <asset>
    <mesh name="lego" file="../lego.obj" scale="0.01 0.01 0.01">
      <plugin instance="sdflego"/>
    </mesh>
  </asset>
  
<default>
  <!-- 更硬的接触参数，减少穿透 -->
  <geom solimp="0.99 0.999 0.0001" solref="0.002 1" friction="0.8 0.01 0.001"/>
</default>

  <worldbody>

    <!-- 托盘：底 + 四壁（“盆”） -->
    <body name="tray" pos="0 0 0">
      <!-- 底板：40 x 40 cm，厚 1 cm -->
      <geom name="tray_floor" type="box" size="0.20 0.20 0.005"
            pos="0 0 0.005" rgba="0.7 0.7 0.7 1" contype="1" conaffinity="1"/>

      <geom name="tray_wall_xpos" type="box" size="0.005 0.20 0.02"
            pos="0.205 0 0.03" rgba="0.6 0.6 0.6 1"/>
      <geom name="tray_wall_xneg" type="box" size="0.005 0.20 0.02"
            pos="-0.205 0 0.03" rgba="0.6 0.6 0.6 1"/>
      <geom name="tray_wall_ypos" type="box" size="0.20 0.005 0.02"
            pos="0 0.205 0.03" rgba="0.6 0.6 0.6 1"/>
      <geom name="tray_wall_yneg" type="box" size="0.20 0.005 0.02"
            pos="0 -0.205 0.03" rgba="0.6 0.6 0.6 1"/>
    </body>

  <body name="hand" pos="0 0 0.413">
    <!-- 允许手在 XY 平面和 Z 方向自由移动 -->
    <joint name="x"    type="slide" axis="1 0 0" range="-0.25 0.25"/>
    <joint name="y"    type="slide" axis="0 1 0" range="-0.25 0.25"/>
    <joint name="lift" type="slide" axis="0 0 1" range="-0.05 0.50"/>
    <joint name="gripper_yaw" type="hinge" axis="0 0 1" limited="true" range="-3.14 3.14"/>

    <!-- 手掌和手指 -->
    <geom name="palm" type="box" size="0.05 .05 0.07" rgba=".2 .2 .2 1"/>
      <body name="right_gripper">
         <joint name="right" type="slide" axis="-1 0 0" range="0 0.1"/>
         <geom name="right_finger" type="box" friction="2.0 0.01 0.00001" size="0.001 0.01 0.15" pos=".18 0 -.2" rgba=".2 .2 .2 1"/>
       </body>
      <body name="left_gripper">
        <joint name="left" type="slide" axis="1 0 0" range="0 0.1"/>
       <geom name="left_finger" type="box" friction="2.0 0.01 0.00001" size="0.001 0.01 0.15" pos="-.18 0 -.2" rgba=".2 .2 .2 1"/>
      </body >
  </body>

    <!-- 10 个 SDF-LEGO，摆成 2 x 5 的小阵列，落在托盘里 -->
    <!-- 单块质量和颜色可按需调整；每个 geom 都有 plugin instance="sdflego" -->
   
      <body name="lego_00" pos="-0.137 0.052 0.083">
        <freejoint/>
        <geom type="sdf" name="lego_00_geom" mesh="lego" mass="0.02" 
              rgba="0.9 0.3 0.1 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_01" pos="0.112 -0.146 0.097">
        <freejoint/>
        <geom type="sdf" name="lego_01_geom" mesh="lego" mass="0.02" 
              rgba="0.9 0.6 0.1 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_02" pos="0.034 0.119 0.101">
        <freejoint/>
        <geom type="sdf" name="lego_02_geom" mesh="lego" mass="0.02" 
              rgba="0.2 0.7 0.2 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_03" pos="-0.165 -0.084 0.092">
        <freejoint/>
        <geom type="sdf" name="lego_03_geom" mesh="lego" mass="0.02" 
              rgba="0.2 0.5 0.9 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_04" pos="0.076 -0.043 0.110">
        <freejoint/>
        <geom type="sdf" name="lego_04_geom" mesh="lego" mass="0.02" 
              rgba="0.6 0.3 0.9 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_05" pos="-0.089 0.173 0.088">
        <freejoint/>
        <geom type="sdf" name="lego_05_geom" mesh="lego" mass="0.02" 
              rgba="0.9 0.3 0.1 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_06" pos="0.145 -0.059 0.126">
        <freejoint/>
        <geom type="sdf" name="lego_06_geom" mesh="lego" mass="0.02" 
              rgba="0.9 0.6 0.1 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_07" pos="-0.042 -0.171 0.132">
        <freejoint/>
        <geom type="sdf" name="lego_07_geom" mesh="lego" mass="0.02" 
              rgba="0.2 0.7 0.2 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_08" pos="0.173 0.081 0.094">
        <freejoint/>
        <geom type="sdf" name="lego_08_geom" mesh="lego" mass="0.02" 
              rgba="0.2 0.5 0.9 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_09" pos="-0.118 -0.122 0.107">
        <freejoint/>
        <geom type="sdf" name="lego_09_geom" mesh="lego" mass="0.02" 
              rgba="0.6 0.3 0.9 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_10" pos="0.082 -0.173 0.115">
        <freejoint/>
        <geom type="sdf" name="lego_10_geom" mesh="lego" mass="0.02" 
              rgba="0.9 0.3 0.1 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_11" pos="0.021 0.147 0.083">
        <freejoint/>
        <geom type="sdf" name="lego_11_geom" mesh="lego" mass="0.02" 
              rgba="0.9 0.6 0.1 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_12" pos="-0.154 -0.037 0.120">
        <freejoint/>
        <geom type="sdf" name="lego_12_geom" mesh="lego" mass="0.02" 
              rgba="0.2 0.7 0.2 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_13" pos="0.134 0.112 0.093">
        <freejoint/>
        <geom type="sdf" name="lego_13_geom" mesh="lego" mass="0.02" 
              rgba="0.2 0.5 0.9 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_14" pos="-0.067 -0.141 0.109">
        <freejoint/>
        <geom type="sdf" name="lego_14_geom" mesh="lego" mass="0.02" 
              rgba="0.6 0.3 0.9 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_15" pos="0.052 0.068 0.087">
        <freejoint/>
        <geom type="sdf" name="lego_15_geom" mesh="lego" mass="0.02" 
              rgba="0.9 0.3 0.1 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_16" pos="0.167 -0.084 0.138">
        <freejoint/>
        <geom type="sdf" name="lego_16_geom" mesh="lego" mass="0.02" 
              rgba="0.9 0.6 0.1 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_17" pos="-0.093 0.091 0.106">
        <freejoint/>
        <geom type="sdf" name="lego_17_geom" mesh="lego" mass="0.02" 
              rgba="0.2 0.7 0.2 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_18" pos="0.043 -0.103 0.094">
        <freejoint/>
        <geom type="sdf" name="lego_18_geom" mesh="lego" mass="0.02" 
              rgba="0.2 0.5 0.9 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_19" pos="-0.142 0.174 0.129">
        <freejoint/>
        <geom type="sdf" name="lego_19_geom" mesh="lego" mass="0.02" 
              rgba="0.6 0.3 0.9 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_20" pos="0.099 -0.166 0.089">
        <freejoint/>
        <geom type="sdf" name="lego_20_geom" mesh="lego" mass="0.02" 
              rgba="0.9 0.3 0.1 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_21" pos="-0.031 -0.062 0.136">
        <freejoint/>
        <geom type="sdf" name="lego_21_geom" mesh="lego" mass="0.02" 
              rgba="0.9 0.6 0.1 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_22" pos="0.154 0.041 0.090">
        <freejoint/>
        <geom type="sdf" name="lego_22_geom" mesh="lego" mass="0.02" 
              rgba="0.2 0.7 0.2 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_23" pos="-0.174 -0.103 0.118">
        <freejoint/>
        <geom type="sdf" name="lego_23_geom" mesh="lego" mass="0.02" 
              rgba="0.2 0.5 0.9 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_24" pos="0.064 0.133 0.085">
        <freejoint/>
        <geom type="sdf" name="lego_24_geom" mesh="lego" mass="0.02" 
              rgba="0.6 0.3 0.9 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_25" pos="-0.157 0.062 0.140">
        <freejoint/>
        <geom type="sdf" name="lego_25_geom" mesh="lego" mass="0.02" 
              rgba="0.9 0.3 0.1 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_26" pos="0.083 -0.122 0.111">
        <freejoint/>
        <geom type="sdf" name="lego_26_geom" mesh="lego" mass="0.02" 
              rgba="0.9 0.6 0.1 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_27" pos="-0.046 0.171 0.092">
        <freejoint/>
        <geom type="sdf" name="lego_27_geom" mesh="lego" mass="0.02" 
              rgba="0.2 0.7 0.2 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_28" pos="0.174 -0.017 0.124">
        <freejoint/>
        <geom type="sdf" name="lego_28_geom" mesh="lego" mass="0.02" 
              rgba="0.2 0.5 0.9 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>

      <body name="lego_29" pos="-0.114 -0.081 0.087">
        <freejoint/>
        <geom type="sdf" name="lego_29_geom" mesh="lego" mass="0.02" 
              rgba="0.6 0.3 0.9 1" friction="2.0 0.01 0.00001">
          <plugin instance="sdflego"/>
        </geom>
      </body>


  </worldbody>

  <!-- 两侧手指对称 -->
  <equality>
    <joint joint1="right" joint2="left"/>
  </equality>

  <tendon>
    <fixed name="grasp">
      <joint joint="right" coef="1"/>
      <joint joint="left"  coef="1"/>
    </fixed>
  </tendon>

  <actuator>
    <position name="x"    joint="x" kp="800" dampratio="1" ctrlrange="-0.25 0.25"/>
    <position name="y"    joint="y" kp="800" dampratio="1" ctrlrange="-0.25 0.25"/>
    <position name="lift"  joint="lift"  kp="600" dampratio="1" ctrlrange="-0.05 0.5"/>
    <position name="grasp" tendon="grasp" kp="200" dampratio="1" ctrlrange="0 0.6"/>
    <position name="rotation" joint="gripper_yaw" kp="200" dampratio="1" ctrlrange="-3.14 3.14"/>

  </actuator>
</mujoco>
